<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="DevConnect Feed - Share projects, ask questions, and connect with developers in our social network for developers."/>
  <title>DevConnect Feed - Developer Social Network</title>
  <link rel="icon" href="/favicon.jpg" type="image/jpeg"/>
  <link rel="manifest" href="/manifest.json"/>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=JetBrains+Mono:wght@400;500&amp;family=Poppins:wght@600;700;800&amp;display=swap" rel="stylesheet"/>

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Quill.js CSS -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"/>

  <!-- jQuery CDN -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- Quill.js CDN -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <!-- Auth Helper -->
  <script src="/auth-helper.js"></script>
  <script src="/auth-check.js"></script>
</head>
<body class="bg-gray-50 font-[&#39;Inter&#39;] text-gray-900 flex flex-col min-h-screen">

  <!-- Header -->
  <header class="fixed top-0 left-0 right-0 bg-white shadow-sm z-50" data-storm-selectable="true" data-storm-selectable-label="Header" data-storm-selectable-category="header">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Brand Logo -->
        <div class="flex-shrink-0">
          <a href="/index.html" class="font-[&#39;Poppins&#39;] font-bold text-2xl text-gray-900 hover:text-blue-600 transition-colors duration-200">
            DevConnect
          </a>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex md:items-center md:space-x-8">
          <a href="/index.html" class="font-[&#39;Inter&#39;] font-medium text-base text-gray-700 hover:text-blue-600 transition-colors duration-200 px-3 py-2 rounded-lg hover:bg-gray-50">
            Feed
          </a>
          <a href="/profile.html" class="font-[&#39;Inter&#39;] font-medium text-base text-gray-700 hover:text-blue-600 transition-colors duration-200 px-3 py-2 rounded-lg hover:bg-gray-50">
            My Profile
          </a>
        </div>

        <!-- User Avatar (Desktop) -->
        <div class="hidden md:flex md:items-center">
          <a href="/profile.html" class="flex items-center" id="desktop-user-avatar-link">
            <img src="/images/user-avatar.jpg" alt="User Profile" data-description="Circular user profile avatar image showing the authenticated user&#39;s profile picture" data-img-width="40" data-img-height="40" class="w-10 h-10 rounded-full border-2 border-gray-200 hover:border-blue-600 transition-colors duration-200" id="desktop-user-avatar"/>
          </a>
        </div>

        <!-- Mobile Menu Button -->
        <div class="md:hidden flex items-center">
          <button type="button" class="inline-flex items-center justify-center p-2 rounded-lg text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition-colors duration-200" aria-label="Toggle menu" id="mobile-menu-button">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile Navigation Menu -->
      <div class="hidden md:hidden border-t border-gray-200" id="mobile-menu">
        <div class="px-2 pt-2 pb-3 space-y-1">
          <a href="/index.html" class="font-[&#39;Inter&#39;] font-medium text-base text-gray-700 hover:text-blue-600 hover:bg-gray-50 block px-3 py-2 rounded-lg transition-colors duration-200">
            Feed
          </a>
          <a href="/profile.html" class="font-[&#39;Inter&#39;] font-medium text-base text-gray-700 hover:text-blue-600 hover:bg-gray-50 block px-3 py-2 rounded-lg transition-colors duration-200">
            My Profile
          </a>
          <div class="pt-4 pb-2 border-t border-gray-200 mt-2">
            <a href="/profile.html" class="flex items-center px-3 py-2" id="mobile-user-avatar-link">
              <img src="/images/user-avatar-mobile.jpg" alt="User Profile" data-description="Circular user profile avatar image for mobile menu showing the authenticated user&#39;s profile picture" data-img-width="32" data-img-height="32" class="w-8 h-8 rounded-full border-2 border-gray-200" id="mobile-user-avatar"/>
              <span class="ml-3 font-[&#39;Inter&#39;] font-medium text-base text-gray-700">View Profile</span>
            </a>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="flex-grow pt-24 pb-12">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
      
      <!-- Page Title -->
      <div class="mb-8" data-storm-selectable="true" data-storm-selectable-label="Page Title" data-storm-selectable-category="text">
        <h1 class="text-4xl font-bold text-gray-900 font-[&#39;Poppins&#39;]">Feed</h1>
        <p class="text-base text-gray-600 mt-2">Share your projects, ask questions, and connect with developers</p>
      </div>

      <!-- Create Post Section -->
      <section class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8" data-storm-selectable="true" data-storm-selectable-label="Create Post Section" data-storm-selectable-category="section">
        <h2 class="text-xl font-semibold text-gray-900 font-[&#39;Poppins&#39;] mb-4">Create a Post</h2>
        
        <!-- Quill Editor -->
        <div id="quill-editor" class="bg-white border border-gray-300 rounded-lg mb-4" style="min-height: 150px;"></div>
        
        <!-- Post Button -->
        <div class="flex justify-end">
          <button type="button" id="create-post-btn" class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200">
            Post
          </button>
        </div>
      </section>

      <!-- Posts Feed -->
      <section id="posts-feed" data-storm-selectable="true" data-storm-selectable-label="Posts Feed" data-storm-selectable-category="section">
        <!-- Posts will be dynamically loaded here -->
        <div id="posts-loading" class="text-center py-12">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
          <p class="text-gray-600 mt-4">Loading posts...</p>
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-50 border-t border-gray-200 mt-auto" data-storm-selectable="true" data-storm-selectable-label="Footer" data-storm-selectable-category="footer">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="flex flex-col items-center space-y-6">
        <!-- Branding Section -->
        <div class="text-center">
          <h3 class="text-xl font-bold text-gray-900 font-[&#39;Poppins&#39;]">DevConnect</h3>
          <p class="text-sm text-gray-600 mt-1">Connecting developers, one post at a time</p>
        </div>
        
        <!-- Navigation Links -->
        <nav class="flex flex-wrap justify-center gap-6">
          <a href="/index.html" class="text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors duration-200">
            Feed
          </a>
          <a href="/profile.html" class="text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors duration-200">
            My Profile
          </a>
        </nav>
        
        <!-- Divider -->
        <div class="w-full max-w-md border-t border-gray-200"></div>
        
        <!-- Copyright and Community Message -->
        <div class="text-center space-y-2">
          <p class="text-xs text-gray-600">
            Built by developers, for developers
          </p>
          <p class="text-xs text-gray-500">
            Â© 2025 DevConnect. All rights reserved.
          </p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Comment Modal -->
  <div id="comment-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full relative">
      <!-- Modal Header -->
      <div class="flex justify-between items-center pb-3 border-b border-gray-200">
        <h3 class="text-xl font-semibold text-gray-900 font-[&#39;Poppins&#39;]">Add Comment</h3>
        <button type="button" class="text-gray-400 hover:text-gray-600" id="close-comment-modal">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <!-- Modal Body -->
      <div class="py-4">
        <textarea id="comment-textarea" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent resize-none" placeholder="Write your comment..."></textarea>
      </div>
      <!-- Modal Footer -->
      <div class="flex justify-end pt-4 border-t border-gray-200 space-x-3">
        <button type="button" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200" id="cancel-comment-btn">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200" id="submit-comment-btn">
          Submit
        </button>
      </div>
    </div>
  </div>

  <script type="module">
    import ClientAPI from '/client.js';
    const api = new ClientAPI();

    let quill;
    let currentUser = null;
    let currentPostIdForComment = null;
    let userCache = {};

    // Initialize Quill editor
    $(document).ready(async function() {
      // Initialize Quill
      quill = new Quill('#quill-editor', {
        theme: 'snow',
        placeholder: 'Share your thoughts, projects, or questions...',
        modules: {
          toolbar: [
            ['bold', 'italic', 'underline', 'strike'],
            ['blockquote', 'code-block'],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            [{ 'header': [1, 2, 3, false] }],
            ['link'],
            ['clean']
          ]
        }
      });

      // Load current user
      try {
        currentUser = await api.getCurrentAuthUser();
        
        // Update header avatars with user's profile picture
        const userProfile = await api.getUserProfile(currentUser.userId);
        if (userProfile && userProfile.profile_picture_url) {
          $('#desktop-user-avatar').attr('src', userProfile.profile_picture_url);
          $('#mobile-user-avatar').attr('src', userProfile.profile_picture_url);
        }
      } catch (error) {
        console.error('Error loading current user:', error);
      }

      // Load posts
      await loadPosts();

      // Mobile menu toggle
      $('#mobile-menu-button').on('click', function() {
        $('#mobile-menu').toggleClass('hidden');
      });

      // Create post button
      $('#create-post-btn').on('click', async function() {
        const content = quill.root.innerHTML.trim();
        
        if (!content || content === '<p><br></p>') {
          return;
        }

        try {
          $(this).prop('disabled', true).text('Posting...');
          
          await api.createPost(content);
          
          // Clear editor
          quill.setContents([]);
          
          // Reload posts
          await loadPosts();
          
          $(this).prop('disabled', false).text('Post');
        } catch (error) {
          console.error('Error creating post:', error);
          $(this).prop('disabled', false).text('Post');
        }
      });

      // Comment modal handlers
      $('#close-comment-modal, #cancel-comment-btn').on('click', function() {
        $('#comment-modal').addClass('hidden');
        $('#comment-textarea').val('');
        currentPostIdForComment = null;
      });

      $('#submit-comment-btn').on('click', async function() {
        const content = $('#comment-textarea').val().trim();
        
        if (!content || !currentPostIdForComment) {
          return;
        }

        try {
          $(this).prop('disabled', true).text('Submitting...');
          
          await api.createComment(currentPostIdForComment, content);
          
          // Close modal
          $('#comment-modal').addClass('hidden');
          $('#comment-textarea').val('');
          
          // Reload comments for this post
          await loadCommentsForPost(currentPostIdForComment);
          
          currentPostIdForComment = null;
          $(this).prop('disabled', false).text('Submit');
        } catch (error) {
          console.error('Error creating comment:', error);
          $(this).prop('disabled', false).text('Submit');
        }
      });

      // Close modal when clicking outside
      $(document).on('click', function(event) {
        if ($(event.target).is('#comment-modal')) {
          $('#comment-modal').addClass('hidden');
          $('#comment-textarea').val('');
          currentPostIdForComment = null;
        }
      });
    });

    // Load all posts
    async function loadPosts() {
      try {
        const response = await api.getAllPosts();
        const posts = response.posts || [];

        $('#posts-loading').hide();

        if (posts.length === 0) {
          $('#posts-feed').html(`
            <div class="text-center py-12 bg-white rounded-lg shadow-sm border border-gray-200">
              <svg class="mx-auto h-16 w-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
              <h3 class="mt-4 text-lg font-semibold text-gray-900 font-['Poppins']">No posts yet</h3>
              <p class="mt-2 text-sm text-gray-600">Be the first to share something with the community!</p>
            </div>
          `);
          return;
        }

        // Render posts
        let postsHTML = '';
        for (const post of posts) {
          postsHTML += await renderPost(post);
        }
        
        $('#posts-feed').html(postsHTML);

        // Attach event handlers
        attachPostEventHandlers();

      } catch (error) {
        console.error('Error loading posts:', error);
        $('#posts-loading').hide();
        $('#posts-feed').html(`
          <div class="text-center py-12 bg-white rounded-lg shadow-sm border border-gray-200">
            <svg class="mx-auto h-16 w-16 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="mt-4 text-lg font-semibold text-gray-900 font-['Poppins']">Couldn't load posts</h3>
            <p class="mt-2 text-sm text-gray-600">Please try again later.</p>
          </div>
        `);
      }
    }

    // Render a single post
    async function renderPost(post) {
      const user = await getUserInfo(post.user_id);
      const username = user ? user.username : 'Unknown User';
      const profilePicture = user && user.profile_picture_url ? user.profile_picture_url : '/images/default-avatar.jpg';
      const timeAgo = formatTimeAgo(post.created_at);
      const isOwnPost = currentUser && currentUser.userId === post.user_id;

      // Load comments for this post
      const comments = await loadCommentsForPostData(post.id);
      const commentsHTML = comments.map(comment => renderComment(comment)).join('');

      return `
        <article class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6" data-post-id="${post.id}" data-storm-selectable="true" data-storm-selectable-label="Post Card" data-storm-selectable-category="section">
          <!-- Post Header -->
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center">
              <a href="/profile.html?user_id=${post.user_id}">
                <img src="${profilePicture}" 
                     alt="${username}" 
                     data-description="User profile picture for ${username}"
                     data-img-width="48"
                     data-img-height="48"
                     class="w-12 h-12 rounded-full border-2 border-gray-200 hover:border-blue-600 transition-colors duration-200">
              </a>
              <div class="ml-3">
                <a href="/profile.html?user_id=${post.user_id}" class="font-semibold text-gray-900 hover:text-blue-600 transition-colors duration-200">
                  ${username}
                </a>
                <p class="text-sm text-gray-600">${timeAgo}</p>
              </div>
            </div>
            ${isOwnPost ? `
              <button type="button" class="text-gray-400 hover:text-red-600 transition-colors duration-200 delete-post-btn" data-post-id="${post.id}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
              </button>
            ` : ''}
          </div>

          <!-- Post Content -->
          <div class="prose max-w-none mb-4 text-gray-700" data-storm-selectable="true" data-storm-selectable-label="Post Content" data-storm-selectable-category="text">
            ${post.content}
          </div>

          <!-- Post Actions -->
          <div class="flex items-center space-x-6 pt-4 border-t border-gray-200">
            <button type="button" class="flex items-center space-x-2 text-gray-600 hover:text-blue-600 transition-colors duration-200 like-btn" data-post-id="${post.id}">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
              </svg>
              <span class="font-medium likes-count">${post.likes_count || 0}</span>
            </button>
            <button type="button" class="flex items-center space-x-2 text-gray-600 hover:text-blue-600 transition-colors duration-200 comment-btn" data-post-id="${post.id}">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
              <span class="font-medium">Comment</span>
            </button>
          </div>

          <!-- Comments Section -->
          <div class="mt-6 pt-6 border-t border-gray-200 comments-section" data-post-id="${post.id}">
            ${commentsHTML || '<p class="text-sm text-gray-500">No comments yet. Be the first to comment!</p>'}
          </div>
        </article>
      `;
    }

    // Render a single comment
    function renderComment(comment) {
      const user = userCache[comment.user_id];
      const username = user ? user.username : 'Unknown User';
      const profilePicture = user && user.profile_picture_url ? user.profile_picture_url : '/images/default-avatar.jpg';
      const timeAgo = formatTimeAgo(comment.created_at);
      const isOwnComment = currentUser && currentUser.userId === comment.user_id;

      return `
        <div class="flex items-start space-x-3 mb-4" data-comment-id="${comment.id}">
          <a href="/profile.html?user_id=${comment.user_id}">
            <img src="${profilePicture}" 
                 alt="${username}" 
                 data-description="User profile picture for ${username}"
                 data-img-width="32"
                 data-img-height="32"
                 class="w-8 h-8 rounded-full border border-gray-200">
          </a>
          <div class="flex-1">
            <div class="bg-gray-100 rounded-lg px-4 py-2">
              <div class="flex items-center justify-between mb-1">
                <a href="/profile.html?user_id=${comment.user_id}" class="font-semibold text-sm text-gray-900 hover:text-blue-600 transition-colors duration-200">
                  ${username}
                </a>
                ${isOwnComment ? `
                  <button type="button" class="text-gray-400 hover:text-red-600 transition-colors duration-200 delete-comment-btn" data-comment-id="${comment.id}">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  </button>
                ` : ''}
              </div>
              <p class="text-sm text-gray-700">${comment.content}</p>
            </div>
            <p class="text-xs text-gray-500 mt-1 ml-4">${timeAgo}</p>
          </div>
        </div>
      `;
    }

    // Attach event handlers to posts
    function attachPostEventHandlers() {
      // Like button
      $('.like-btn').off('click').on('click', async function() {
        const postId = $(this).data('post-id');
        const $likesCount = $(this).find('.likes-count');
        const currentCount = parseInt($likesCount.text()) || 0;

        try {
          // Toggle like
          await api.likePost(postId);
          $likesCount.text(currentCount + 1);
        } catch (error) {
          if (error.message && error.message.includes('already liked')) {
            // Unlike
            try {
              await api.unlikePost(postId);
              $likesCount.text(Math.max(0, currentCount - 1));
            } catch (unlikeError) {
              console.error('Error unliking post:', unlikeError);
            }
          } else {
            console.error('Error liking post:', error);
          }
        }
      });

      // Comment button
      $('.comment-btn').off('click').on('click', function() {
        currentPostIdForComment = $(this).data('post-id');
        $('#comment-modal').removeClass('hidden');
        $('#comment-textarea').focus();
      });

      // Delete post button
      $('.delete-post-btn').off('click').on('click', async function() {
        const postId = $(this).data('post-id');
        
        if (confirm('Are you sure you want to delete this post?')) {
          try {
            await api.deletePost(postId);
            $(`[data-post-id="${postId}"]`).fadeOut(300, function() {
              $(this).remove();
            });
          } catch (error) {
            console.error('Error deleting post:', error);
          }
        }
      });

      // Delete comment button
      $('.delete-comment-btn').off('click').on('click', async function() {
        const commentId = $(this).data('comment-id');
        
        if (confirm('Are you sure you want to delete this comment?')) {
          try {
            await api.deleteComment(commentId);
            $(`[data-comment-id="${commentId}"]`).fadeOut(300, function() {
              $(this).remove();
            });
          } catch (error) {
            console.error('Error deleting comment:', error);
          }
        }
      });
    }

    // Load comments for a post and update UI
    async function loadCommentsForPost(postId) {
      const comments = await loadCommentsForPostData(postId);
      const commentsHTML = comments.map(comment => renderComment(comment)).join('');
      
      const $commentsSection = $(`.comments-section[data-post-id="${postId}"]`);
      if (commentsHTML) {
        $commentsSection.html(commentsHTML);
      } else {
        $commentsSection.html('<p class="text-sm text-gray-500">No comments yet. Be the first to comment!</p>');
      }
      
      attachPostEventHandlers();
    }

    // Load comments for a post (returns data)
    async function loadCommentsForPostData(postId) {
      try {
        const response = await api.getAllComments(postId);
        const comments = response.comments || [];
        
        // Load user info for all commenters
        for (const comment of comments) {
          if (!userCache[comment.user_id]) {
            await getUserInfo(comment.user_id);
          }
        }
        
        return comments;
      } catch (error) {
        console.error('Error loading comments:', error);
        return [];
      }
    }

    // Get user info (with caching)
    async function getUserInfo(userId) {
      if (userCache[userId]) {
        return userCache[userId];
      }

      try {
        const user = await api.getUserProfile(userId);
        userCache[userId] = user;
        return user;
      } catch (error) {
        console.error('Error loading user info:', error);
        return null;
      }
    }

    // Format timestamp to relative time
    function formatTimeAgo(timestamp) {
      const now = Math.floor(Date.now() / 1000);
      const diff = now - timestamp;

      if (diff < 60) {
        return 'just now';
      } else if (diff < 3600) {
        const minutes = Math.floor(diff / 60);
        return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
      } else if (diff < 86400) {
        const hours = Math.floor(diff / 3600);
        return `${hours} hour${hours > 1 ? 's' : ''} ago`;
      } else if (diff < 604800) {
        const days = Math.floor(diff / 86400);
        return `${days} day${days > 1 ? 's' : ''} ago`;
      } else {
        const date = new Date(timestamp * 1000);
        return date.toLocaleDateString();
      }
    }

    // Attach window functions for global access
    window.loadPosts = loadPosts;
    window.loadCommentsForPost = loadCommentsForPost;
  </script>



</body></html>